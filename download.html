<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶æ—ã‚¢ãƒ«ãƒãƒ vivi - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</title> 
    <link rel="stylesheet" href="vivi_album_style.css"> 

</head>
<body>
    <div class="app-container">
        <div class="download-modal-overlay">
            <div class="download-modal-content">
                <header class="modal-header">
                    <h2>å†™çœŸãƒ»å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h2>
                    <button class="close-button" onclick="closeModal()">Ã—</button>
                </header>
                
                <p>ä»¥ä¸‹ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>

                <ul id="download-list" class="download-list">
                    </ul>

                <div class="total-info">
                    åˆè¨ˆ: <span id="total-count">0</span> ç‚¹
                </div>

                <div class="download-button-area">
                    <button class="primary-button" onclick="startDownload()">
                        <span class="icon">â¬‡ï¸</span> ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¦å…ƒã®ç”»é¢ã«æˆ»ã‚‹
         */
        function closeModal() {
            // download.html ã¯å¸¸ã« top.html ã‹ã‚‰é·ç§»ã™ã‚‹ã¨ä»®å®šã—ã¦æˆ»ã‚‹
            history.back();
        }

        /**
         * ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã®é–‹å§‹ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
         */
        function startDownload() {
            // ğŸ’¡ ä¿®æ­£: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Œäº†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã€å…ƒã®ç”»é¢ã«æˆ»ã‚‹
            //alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã‚¢ãƒ«ãƒãƒ ä¸€è¦§ã«æˆ»ã‚Šã¾ã™ã€‚'); 
            location.href = 'top.html?reset=true';
        }

        /**
         * URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰é¸æŠã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦è¡¨ç¤º
         */
        function loadDownloadList() {
            const params = new URLSearchParams(window.location.search);
            const itemsParam = params.get('items');
            const downloadListElement = document.getElementById('download-list');
            const totalCountElement = document.getElementById('total-count');
            let totalPhotos = 0;

            if (!itemsParam) {
                downloadListElement.innerHTML = '<p style="text-align:center; color:#999;">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯¾è±¡ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>';
                return;
            }

            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹: "albumId:albumName:photoCount,..."
            const items = itemsParam.split(',');
            downloadListElement.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢

            items.forEach(itemString => {
                const parts = itemString.split(':');
                if (parts.length === 3) {
                    const albumId = parts[0];
                    const albumName = decodeURIComponent(parts[1]).replace(/\s\(\d+æš\)/, ''); // (5æš)ãªã©ã‚’å‰Šé™¤
                    const photoCount = parseInt(parts[2], 10);

                    if (!isNaN(photoCount) && photoCount > 0) {
                        const listItem = document.createElement('li');
                        listItem.className = 'download-item';
                        listItem.innerHTML = `
                            <span class="name">${albumName}</span>
                            <span class="count">${photoCount}ç‚¹</span>
                        `;
                        downloadListElement.appendChild(listItem);
                        totalPhotos += photoCount;
                    }
                }
            });

            // åˆè¨ˆã‚’æ›´æ–°
            totalCountElement.textContent = `${totalPhotos}`;

            // é¸æŠã•ã‚ŒãŸã‚¢ãƒ«ãƒãƒ ãŒãªã„å ´åˆã®ä»£æ›¿å‡¦ç†ï¼ˆå¿µã®ãŸã‚ï¼‰
            if (totalPhotos === 0) {
                 downloadListElement.innerHTML = '<p style="text-align:center; color:#999;">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯¾è±¡ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>';
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', loadDownloadList);
    </script>
</body>
</html>
