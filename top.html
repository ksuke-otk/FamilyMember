<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶æ—ã‚¢ãƒ«ãƒãƒ vivi - ã‚¢ãƒ«ãƒãƒ </title>
    <link rel="stylesheet" href="vivi_album_style.css">
</head>
<body>
    <div class="app-container">
        <header class="top-bar">
            <div class="header-left"></div> 
            <div class="header-center"><h1>ã‚¢ãƒ«ãƒãƒ ä¸€è¦§</h1></div>
            <div class="header-right"></div>
        
        </header>
        <nav class="album-tabs">
            <button class="tab" onclick="location.href='calendar.html'">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
            <button class="tab active" onclick="location.href='top.html'">ä¸€è¦§</button>
        </nav>
        <main class="main-content">



            <section id="album-section" class="member-section active">
                <button class="primary-button" onclick="location.href='pricture_add.html'">
                    <span class="icon">ï¼‹</span> æ–°ã—ã„å†™çœŸãƒ»å‹•ç”»ã‚’è¿½åŠ 
                </button>
                <div class="title-with-button">
                    <h2 class="section-title">å®¶æ—ã®æ€ã„å‡ºã‚¢ãƒ«ãƒãƒ </h2>
                    <div class="select-all-container">
                        <input type="checkbox" id="select-all-checkbox" onclick="toggleSelectAll(this.checked)">
                        <label for="select-all-checkbox">ã™ã¹ã¦é¸æŠ</label>
                    </div>
                    <button class="secondary-button icon-only-button" onclick="updateDownloadUrl()">
                        <span class="icon">â¬‡ï¸</span>
                    </button>
                </div>
                <div class="album-dropdown-container">
                    <label for="album-selector" class="dropdown-label">ã‚¢ãƒ«ãƒãƒ é¸æŠ:</label>
                    <select id="album-selector" class="album-dropdown" onchange="showAlbumSection(this.value, this)">
                        <option value="all">ã™ã¹ã¦</option>
                        <option value="ichiro">ä¸€éƒãã‚“</option>
                        <option value="yoshiko">è‰¯å­ã¡ã‚ƒã‚“</option>
                    </select>
                </div>



                <ul class="member-list">
                    <li class="member-item" onclick="handleAlbumItemClick(this, event)" data-id="1" data-photo-count="3">
                        <div class="checkbox-area">
                            <input type="checkbox" class="album-checkbox" onclick="event.stopPropagation(); updateItemSelection(this.closest('.member-item'))">
                        </div>
                        <div class="info">
                            <a href="picture_detail.html" class="album-title-link" onclick="event.stopPropagation();">
                            </a>
                            <span class="name">ä¸ƒäº”ä¸‰ (3æš)</span><br>
                            <div class="photo-grid">
                                <div class="photo-item" onclick="location.href='picture_detail.html?id=001'">
                                    <img src="placeholder_1.jpg" alt="å†™çœŸ1" class="photo-thumbnail">
                                </div>
                                <div class="photo-item" onclick="location.href='picture_detail.html?id=002'">
                                    <img src="placeholder_2.jpg" alt="å†™çœŸ2" class="photo-thumbnail">
                                </div>
                                <div class="photo-item" onclick="location.href='picture_detail.html?id=003'">
                                    <img src="placeholder_3.jpg" alt="å†™çœŸ3" class="photo-thumbnail">
                                </div>
                            </div>
                            <span class="role">2024-11</span>
                        </div>
                    </li>

                    <li class="member-item" onclick="handleAlbumItemClick(this, event)" data-id="2" data-photo-count="2">
                        <div class="checkbox-area">
                            <input type="checkbox" class="album-checkbox" onclick="event.stopPropagation(); updateItemSelection(this.closest('.member-item'))">
                        </div>
                        <div class="info">
                            <span class="name">é‹å‹•ä¼š (2æš)</span><br>
                            <div class="photo-grid">
                                <div class="photo-item" onclick="location.href='picture_detail.html?id=004'">
                                    <img src="placeholder_4.jpg" alt="å†™çœŸ4" class="photo-thumbnail">
                                </div>
                                <div class="photo-item" onclick="location.href='picture_detail.html?id=005'">
                                    <img src="placeholder_5.jpg" alt="å†™çœŸ5" class="photo-thumbnail">
                                </div>
                            </div>
                            <span class="role">2024-10</span>
                        </div>
                    </li>

                    <li class="member-item" onclick="handleAlbumItemClick(this, event)" data-id="3" data-photo-count="5">
                        <div class="checkbox-area">
                            <input type="checkbox" class="album-checkbox" onclick="event.stopPropagation(); updateItemSelection(this.closest('.member-item'))">
                        </div>
                        <div class="info">
                            <span class="name">å¤ã®æµ·æ—…è¡Œ (5æš)</span><br>
                            <div class="photo-grid">
                                <div class="photo-item" onclick="location.href='picture_detail.html?id=006'">
                                    <img src="placeholder_6.jpg" alt="å†™çœŸ6" class="photo-thumbnail">
                                </div>
                                <div class="photo-item" onclick="location.href='picture_detail.html?id=007'">
                                    <img src="placeholder_7.jpg" alt="å†™çœŸ7" class="photo-thumbnail">
                                </div>
                                <div class="photo-item" onclick="location.href='picture_detail.html?id=008'">
                                    <img src="placeholder_8.jpg" alt="å†™çœŸ8" class="photo-thumbnail">
                                </div>
                            </div>
                            <span class="role">2024-8</span>
                        </div>
                    </li>
                </ul>
            </section>
        </main>

        <nav class="bottom-nav">
            <a href="top.html" class="nav-item active"><span class="icon">ğŸ–¼ï¸</span>ã‚¢ãƒ«ãƒãƒ </a>
            <a href="height_measure.html" class="nav-item"><span class="icon">ğŸ“·</span>ã‚«ãƒ¡ãƒ©</a>
            <a href="family_member.html" class="nav-item"><span class="icon">âš™ï¸</span>è¨­å®š</a>
        </nav>
    </div>

    <script>
        /**
        Â * å®¶æ—ã‚¢ãƒ«ãƒãƒ vivi - ã‚¢ãƒ«ãƒãƒ ä¸€è¦§ãƒšãƒ¼ã‚¸ (top.html) ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        Â * * ä¸»ãªæ©Ÿèƒ½:
        Â * 1. ã‚¢ãƒ«ãƒãƒ ã‚¢ã‚¤ãƒ†ãƒ ã®é¸æŠ/é¸æŠè§£é™¤ (é¸æŠãƒ¢ãƒ¼ãƒ‰)
        Â * 2. å…¨é¸æŠãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ç®¡ç†
        Â * 3. ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã«ã‚ˆã‚‹ã‚¢ãƒ«ãƒãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ‡ã‚Šæ›¿ãˆ (ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿)
        Â * 4. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã®ãŸã‚ã®é¸æŠãƒ‡ãƒ¼ã‚¿åé›†ã¨ç”»é¢é·ç§»
        Â * 5. ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®é¸æŠçŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
        Â */
        
        // å…±é€šã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆå‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«ç­‰ãŒå«ã¾ã‚Œã¦ã„ã¦ã‚‚å•é¡Œãªã—ï¼‰
        let memberToDeleteId = null;
        
        // family_member.htmlç”¨ã®é–¢æ•°ã ãŒã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æ®‹ã—ã¦ãŠã
        function showSection(sectionId, element) {
           console.warn('showSection: top.htmlã§ã¯ showAlbumSection ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚');
        }
        
        // å‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ (ã“ã®ç”»é¢ã§ã¯æœªä½¿ç”¨ã ãŒã€ä»–ã®ç”»é¢ã¨ã®å…±é€šåŒ–ã®ãŸã‚æ®‹ã™)
        function showDeleteModal(memberName, memberId) {
            memberToDeleteId = memberId;
            document.getElementById('modal-message').textContent = `ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`;
            document.getElementById('delete-modal').style.display = 'flex';
        }
        
        function hideDeleteModal() {
            memberToDeleteId = null;
            document.getElementById('delete-modal').style.display = 'none';
        }
        
        function deleteMemberConfirmed() {
            if (memberToDeleteId) {
                const memberElement = document.querySelector(`.member-item > .delete-icon[onclick$="'${memberToDeleteId}')"]`).closest('.member-item');
                if (memberElement) {
                memberElement.remove();
                }
                alert(`ID ${memberToDeleteId} ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
            }
            hideDeleteModal();
        }
        
        /**
        Â * ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¯ãƒªãƒƒã‚¯åˆ¶å¾¡
        Â * æ—¢ã«é¸æŠã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ã‚Œã°é¸æŠã‚’ãƒˆã‚°ãƒ«ã€ãªã‘ã‚Œã°è©³ç´°ç”»é¢ã«é·ç§»ã€‚
        Â * @param {HTMLElement} item - ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸ .member-item è¦ç´ 
        Â * @param {Event} event - ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        Â */
        function handleAlbumItemClick(item, event) {
            // ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒï¼ˆphoto-itemï¼‰å†…ã®ã‚¯ãƒªãƒƒã‚¯ã¯ã€å€‹åˆ¥ã®è©³ç´°é·ç§»ã‚’å„ªå…ˆã™ã‚‹ãŸã‚ã€è¦ªè¦ç´ ã®å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
            if (event.target.closest('.photo-item')) {
                return;
            }
            
            const selectedItems = document.querySelectorAll('.member-item.selected-item');
            const dataId = item.getAttribute('data-id');
    
            // æ—¢ã«ä¸€ã¤ã§ã‚‚é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ã‚‹å ´åˆ -> é¸æŠãƒ¢ãƒ¼ãƒ‰
            if (selectedItems.length > 0) {
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é˜»æ­¢ã—ã€é¸æŠã‚’ãƒˆã‚°ãƒ«
                event.preventDefault();
                event.stopPropagation();
                toggleItemSelection(item);
            } else {
                // é¸æŠä¸­ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒä»–ã«ãªã„å ´åˆ -> è©³ç´°ç”»é¢ã¸é·ç§»
                // ä¿®æ­£ç®‡æ‰€: é·ç§»å…ˆã‚’ picture_detail.html ã«ä¿®æ­£
                location.href = `picture_detail.html?id=${dataId}`;
            }
        }
        
        /**
        Â * ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®é¸æŠçŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«ã™ã‚‹
        Â * @param {HTMLElement} item - ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸ .member-item è¦ç´ 
        Â */
        function toggleItemSelection(item) {
            // .member-item ã« .selected-item ã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘å¤–ã—
            item.classList.toggle('selected-item');
            
            // å†…éƒ¨ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’åŒæœŸ
            const checkbox = item.querySelector('.album-checkbox');
            if (checkbox) {
                checkbox.checked = item.classList.contains('selected-item');
            }
        
            // å…¨é¸æŠãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚‚æ›´æ–°
            updateSelectAllCheckbox();
        }
        
        /**
        Â * ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã«åŸºã¥ã„ã¦ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ (ä¸»ã«ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒƒã‚¯æ™‚)
        Â * @param {HTMLElement} item - å¤‰æ›´ã•ã‚ŒãŸ .member-item è¦ç´ 
        Â */
        function updateItemSelection(item) {
            const checkbox = item.querySelector('.album-checkbox');
            if (checkbox.checked) {
                item.classList.add('selected-item');
            } else {
                item.classList.remove('selected-item');
            }
            updateSelectAllCheckbox();
        }
        
        /**
        Â * å…¨é¸æŠãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ (select-all-checkbox) ã®çŠ¶æ…‹ã‚’ã€ç¾åœ¨ã®ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®é¸æŠçŠ¶æ³ã«åŸºã¥ã„ã¦æ›´æ–°
        Â */
        function updateSelectAllCheckbox() {
            const allItems = document.querySelectorAll('.member-item');
            const selectedItems = document.querySelectorAll('.member-item.selected-item');
            const selectAllCheckbox = document.getElementById('select-all-checkbox');
        
            if (!selectAllCheckbox) return;
        
            if (allItems.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (selectedItems.length === allItems.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else if (selectedItems.length > 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            }
        }
        
        /**
        Â * å…¨ã¦ã®ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®é¸æŠ/å…¨è§£é™¤ã‚’è¡Œã†
        Â * @param {boolean} isChecked - å…¨é¸æŠãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ (true: å…¨é¸æŠ, false: å…¨è§£é™¤)
        Â */
        function toggleSelectAll(isChecked) {
            const allItems = document.querySelectorAll('.member-item');
            allItems.forEach(item => {
              const checkbox = item.querySelector('.album-checkbox');
                 if (checkbox) {
                     checkbox.checked = isChecked;
                    if (isChecked) {
                        item.classList.add('selected-item');
                    } else {
                        item.classList.remove('selected-item');
                    }
                }
            });
            // å…¨é¸æŠ/å…¨è§£é™¤ã«åˆã‚ã›ã¦ã€å…¨é¸æŠãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®checkedçŠ¶æ…‹ã‚‚æ›´æ–°
            const selectAllCheckbox = document.getElementById('select-all-checkbox');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = isChecked;
                selectAllCheckbox.indeterminate = false;
            }
        }
        
        /**
        Â * ã‚¢ãƒ«ãƒãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ‡ã‚Šæ›¿ãˆ (ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å¯¾å¿œ)
        Â * @param {string} albumId - åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚¢ãƒ«ãƒãƒ ã®ID ('all', 'ichiro', 'yoshiko'ãªã©)
        Â * @param {HTMLElement} element - å¤‰æ›´ã•ã‚ŒãŸ select è¦ç´ 
        Â */
        function showAlbumSection(albumId, element) {
            console.log(`ã‚¢ãƒ«ãƒãƒ ã‚’åˆ‡ã‚Šæ›¿ãˆ: ${albumId}`);
        
            const list = document.querySelector('.member-list');
            list.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ (å®Ÿéš›ã®ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
        
            const clickHandler = "handleAlbumItemClick(this, event)"; 
        
// ãƒ€ãƒŸãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å†æç”»
if (albumId === 'all') {
        list.innerHTML = `
        <li class="member-item" onclick="${clickHandler}" data-id="1" data-photo-count="3">
            <div class="checkbox-area">
                <input type="checkbox" class="album-checkbox" onclick="event.stopPropagation(); updateItemSelection(this.closest('.member-item'))">
            </div>
            <div class="info">
                <span class="name">ä¸ƒäº”ä¸‰ (3æš)</span><br>
                <div class="photo-grid">
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=001'">
                        <img src="placeholder_1.jpg" alt="å†™çœŸ1" class="photo-thumbnail">
                    </div>
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=002'">
                        <img src="placeholder_2.jpg" alt="å†™çœŸ2" class="photo-thumbnail">
                    </div>
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=003'">
                        <img src="placeholder_3.jpg" alt="å†™çœŸ3" class="photo-thumbnail">
                    </div>
                </div>
                <span class="role">2024-11</span>
            </div>
        </li>
        <li class="member-item" onclick="${clickHandler}" data-id="2" data-photo-count="2">
            <div class="checkbox-area">
                <input type="checkbox" class="album-checkbox" onclick="event.stopPropagation(); updateItemSelection(this.closest('.member-item'))">
            </div>
            <div class="info">
                <span class="name">é‹å‹•ä¼š (2æš)</span><br>
                <div class="photo-grid">
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=004'">
                        <img src="placeholder_4.jpg" alt="å†™çœŸ4" class="photo-thumbnail">
                    </div>
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=005'">
                        <img src="placeholder_5.jpg" alt="å†™çœŸ5" class="photo-thumbnail">
                    </div>
                </div>
                <span class="role">2024-10</span>
            </div>
        </li>
        <li class="member-item" onclick="${clickHandler}" data-id="3" data-photo-count="5">
            <div class="checkbox-area">
                <input type="checkbox" class="album-checkbox" onclick="event.stopPropagation(); updateItemSelection(this.closest('.member-item'))">
            </div>
            <div class="info">
                <span class="name">å¤ã®æµ·æ—…è¡Œ (5æš)</span><br>
                <div class="photo-grid">
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=006'">
                        <img src="placeholder_6.jpg" alt="å†™çœŸ6" class="photo-thumbnail">
                    </div>
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=007'">
                        <img src="placeholder_7.jpg" alt="å†™çœŸ7" class="photo-thumbnail">
                    </div>
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=008'">
                        <img src="placeholder_8.jpg" alt="å†™çœŸ8" class="photo-thumbnail">
                    </div>
                </div>
                <span class="role">2024-8</span>
            </div>
        </li>
        `;
    } else if (albumId === 'ichiro') {
        // ğŸ’¡ ä¿®æ­£å¾Œ: <li class="member-item" onclick="${clickHandler}" ...> ã®å½¢å¼ã«æˆ»ã™
        list.innerHTML = `
        <li class="member-item" onclick="${clickHandler}" data-id="1" data-photo-count="3">
            <div class="checkbox-area">
                <input type="checkbox" class="album-checkbox" onclick="event.stopPropagation(); updateItemSelection(this.closest('.member-item'))">
            </div>
            <div class="info">
                <span class="name">ä¸€éƒãã‚“ã®ä¸ƒäº”ä¸‰ (3æš)</span><br>
                <div class="photo-grid">
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=001'">
                        <img src="placeholder_1.jpg" alt="å†™çœŸ1" class="photo-thumbnail">
                    </div>
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=002'">
                        <img src="placeholder_2.jpg" alt="å†™çœŸ2" class="photo-thumbnail">
                    </div>
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=003'">
                        <img src="placeholder_3.jpg" alt="å†™çœŸ3" class="photo-thumbnail">
                    </div>
                </div>
                <span class="role">2024-11</span>
            </div>
        </li>
        `;
    } else if (albumId === 'yoshiko') {
        // ğŸ’¡ ä¿®æ­£å¾Œ: <li class="member-item" onclick="${clickHandler}" ...> ã®å½¢å¼ã«æˆ»ã™
        list.innerHTML = `
        <li class="member-item" onclick="${clickHandler}" data-id="2" data-photo-count="2">
            <div class="checkbox-area">
                <input type="checkbox" class="album-checkbox" onclick="event.stopPropagation(); updateItemSelection(this.closest('.member-item'))">
            </div>
            <div class="info">
                <span class="name">è‰¯å­ã¡ã‚ƒã‚“ã®é‹å‹•ä¼š (2æš)</span><br>
                <div class="photo-grid">
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=004'">
                        <img src="placeholder_4.jpg" alt="å†™çœŸ4" class="photo-thumbnail">
                    </div>
                    <div class="photo-item" onclick="location.href='picture_detail.html?id=005'">
                        <img src="placeholder_5.jpg" alt="å†™çœŸ5" class="photo-thumbnail">
                    </div>
                </div>
                <span class="role">2024-10</span>
            </div>
        </li>
        `;
    }
        
            // ã‚¢ãƒ«ãƒãƒ åˆ‡ã‚Šæ›¿ãˆå¾Œã€é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            toggleSelectAll(false);
        }
        
        
        /**
        Â * é¸æŠã•ã‚ŒãŸå†™çœŸIDã¨æƒ…å ±ã‚’åé›†ã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”»é¢ã«é·ç§»ã™ã‚‹
        Â */
        function updateDownloadUrl() {
            const selectedItems = document.querySelectorAll('.member-item.selected-item');
            if (selectedItems.length === 0) {
                alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å†™çœŸãƒ»å‹•ç”»ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }
        
            // é¸æŠã•ã‚ŒãŸã‚¢ãƒ«ãƒãƒ IDã€ã‚¢ãƒ«ãƒãƒ åã€å†™çœŸæ•°ã‚’åé›†
            const selectedData = [];
            selectedItems.forEach(item => {
                const albumId = item.getAttribute('data-id');
                const photoCountAttr = item.getAttribute('data-photo-count');
         
                // .nameã‹ã‚‰ã‚¢ãƒ«ãƒãƒ åã‚’å–å¾—ã—ã€(næš)ã®è¡¨è¨˜ã‚’å‰Šé™¤
                const albumName = item.querySelector('.name').textContent.replace(/\s\(\d+æš\)/, '').trim(); 
         
                // photoCountãŒå­˜åœ¨ã—ãªã„å ´åˆã‚„ç„¡åŠ¹ãªå ´åˆã¯1ã¨ã™ã‚‹
                const photoCount = parseInt(photoCountAttr, 10) || 1; 
        
                if (albumId) {
                // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: [ã‚¢ãƒ«ãƒãƒ ID]:[ã‚¢ãƒ«ãƒãƒ å (URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰)]:[å†™çœŸæ•°]
                    selectedData.push(`${albumId}:${encodeURIComponent(albumName)}:${photoCount}`);
                }
            });
         
            if (selectedData.length === 0) {
                alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å†™çœŸãƒ»å‹•ç”»ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }
          
            // ãƒ‡ãƒ¼ã‚¿ã‚’URLã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦é·ç§»
            const selectedIdsParam = selectedData.join(',');
            location.href = `download.html?items=${selectedIdsParam}`;
        }
        
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã¾ãŸã¯BFCacheã‹ã‚‰ã®å¾©å…ƒæ™‚ (å±¥æ­´ã§æˆ»ã£ãŸæ™‚) ã«å®Ÿè¡Œ
        document.addEventListener('pageshow', (event) => {
            // ç”»é¢è¡¨ç¤ºæ™‚ã«å…¨ã¦ã®é¸æŠçŠ¶æ…‹ã‚’è§£é™¤ã—ã¾ã™ã€‚
            toggleSelectAll(false);
        });
        
        // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã€ã¾ãŸã¯ãƒªã‚»ãƒƒãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãã§ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚ŒãŸå ´åˆã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const shouldReset = params.get('reset') === 'true';
        
            if (shouldReset) {
                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¨é¸æŠçŠ¶æ…‹ã‚’ã™ã¹ã¦è§£é™¤
                toggleSelectAll(false);
        
                // å±¥æ­´ã®URLã‹ã‚‰ reset=true ã‚’æ¶ˆã™ï¼ˆå†èª­ã¿è¾¼ã¿æ™‚ã«å†ãƒªã‚»ãƒƒãƒˆã—ãªã„ãŸã‚ï¼‰
                history.replaceState(null, '', 'top.html');
            } 
        });
            </script>
</body>
</html>
