<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶æ—ã‚¢ãƒ«ãƒãƒ vivi - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
    <link rel="stylesheet" href="vivi_album_style.css">
</head>
<body>
    <div class="app-container">
        <header class="top-bar">
            <div class="header-left"></div> 
            <div class="header-center"><h1>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1></div>
            <div class="header-right"></div>
        </header>
        <nav class="album-tabs">
            <button class="tab active" onclick="location.href='calendar.html'">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
            <button class="tab " onclick="location.href='top.html'">ä¸€è¦§</button>
        </nav>
        
        <main class="main-content">
            <div class="album-dropdown-container">
                <label for="album-selector" class="dropdown-label">ã‚¢ãƒ«ãƒãƒ é¸æŠ:</label>
                <select id="album-selector" class="album-dropdown" onchange="showAlbumSection(this.value, this)">
                    <option value="all">ã™ã¹ã¦</option>
                    <option value="ichiro">ä¸€éƒãã‚“</option>
                    <option value="yoshiko">è‰¯å­ã¡ã‚ƒã‚“</option>
                </select>
            </div>
            <section id="calendar-view">
                <div class="calendar-nav">
                    <button class="icon-only-button" style="font-size: 1.5em;" onclick="prevMonth()">ï¼œ</button>
                    <h2 id="current-month-year">YYYYå¹´Mæœˆ</h2>
                    <button class="icon-only-button" style="font-size: 1.5em;" onclick="nextMonth()">ï¼</button>
                </div>
                
                <div class="calendar-grid" id="calendar-grid">
                    <div class="day-header">æ—¥</div>
                    <div class="day-header">æœˆ</div>
                    <div class="day-header">ç«</div>
                    <div class="day-header">æ°´</div>
                    <div class="day-header">æœ¨</div>
                    <div class="day-header">é‡‘</div>
                    <div class="day-header">åœŸ</div>

                    </div>
            </section>
      </main>

        <nav class="bottom-nav">
            <a href="top.html" class="nav-item active"><span class="icon">ğŸ–¼ï¸</span>ã‚¢ãƒ«ãƒãƒ </a>
            <a href="height_measure.html" class="nav-item"><span class="icon">ğŸ“·</span>ã‚«ãƒ¡ãƒ©</a>
            <a href="family_member.html" class="nav-item"><span class="icon">âš™ï¸</span>è¨­å®š</a>
        </nav>
    </div>
<script>
    // æ—¢å­˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯çœç•¥...
    let memberToDeleteId = null;
    // ... (æ—¢å­˜ã® showSection, showDeleteModal, showAlbumSection é–¢æ•°ãªã©) ...
    
    // ===========================================
    // ğŸ’¡ ã€è¿½è¨˜ã€‘ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è‡ªå‹•æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯
    // ===========================================

    // é–²è¦§ä¸­ã®å¹´æœˆã‚’ä¿æŒã™ã‚‹Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    let viewingDate = new Date(); 

    // ã‚µãƒ³ãƒ—ãƒ«ã®å†™çœŸæŠ•ç¨¿æ—¥ãƒ‡ãƒ¼ã‚¿ (YYYY-MM-DD å½¢å¼)
    // å®Ÿéš›ã«ã¯APIã‹ã‚‰å–å¾—ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
    const photoDates = [
        '2025-11-02', 
        '2025-11-05', 
        '2025-11-08',
        // ä¾‹ã¨ã—ã¦ã€ç¾åœ¨ã®æœˆã§ã¯ãªã„æ—¥ä»˜ã‚‚ã„ãã¤ã‹å«ã‚ã¾ã™
        '2024-12-25',
        '2026-01-01'
    ];

    /**
     * å¹´æœˆè¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
     */
    function updateMonthYearDisplay() {
        const year = viewingDate.getFullYear();
        // getMonth() ã¯ 0-11 ã‚’è¿”ã™ãŸã‚ +1
        const month = viewingDate.getMonth() + 1; 
        document.getElementById('current-month-year').textContent = `${year}å¹´${month}æœˆ`;
    }

    /**
     * æŒ‡å®šã•ã‚ŒãŸå¹´æœˆã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰ã‚’ç”Ÿæˆã™ã‚‹
     */
    function renderCalendar() {
        const calendarGrid = document.getElementById('calendar-grid');
        
        // æ—¢å­˜ã®æ—¥ä»˜ã‚»ãƒ«ã‚’å‰Šé™¤ï¼ˆæ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼7ã¤ã¯æ®‹ã™ï¼‰
        while (calendarGrid.children.length > 7) {
            calendarGrid.removeChild(calendarGrid.lastChild);
        }
        
        const year = viewingDate.getFullYear();
        const month = viewingDate.getMonth(); // 0-indexed
        
        const today = new Date();
        const todayYear = today.getFullYear();
        const todayMonth = today.getMonth();
        const todayDate = today.getDate();

        // 1. ãã®æœˆã®æœ€åˆã®æ—¥ (1æ—¥) ã®æ›œæ—¥ã‚’å–å¾— (0:æ—¥, 1:æœˆ, ..., 6:åœŸ)
        const firstDayOfMonth = new Date(year, month, 1);
        const startDayOfWeek = firstDayOfMonth.getDay(); 

        // 2. ãã®æœˆã®æœ€çµ‚æ—¥ã‚’å–å¾—
        const lastDayOfMonth = new Date(year, month + 1, 0).getDate(); 
        
        // 3. å‰æœˆã®æœ€çµ‚æ—¥ã‚’å–å¾—
        const lastDayOfPrevMonth = new Date(year, month, 0).getDate();

        let nextMonthDayCount = 1;

        // å‰æœˆã®æ—¥ä»˜ã‚»ãƒ«ã‚’ç”Ÿæˆ (inactive)
        for (let i = 0; i < startDayOfWeek; i++) {
            const date = lastDayOfPrevMonth - startDayOfWeek + i + 1;
            const cell = createDayCell(date, true, false, null, false); 
            calendarGrid.appendChild(cell);
        }

        // ä»Šæœˆã®æ—¥ä»˜ã‚»ãƒ«ã‚’ç”Ÿæˆ
        for (let i = 1; i <= lastDayOfMonth; i++) {
            const isToday = (year === todayYear && month === todayMonth && i === todayDate);
            // YYYY-MM-DDå½¢å¼ã®æ–‡å­—åˆ—ã‚’ä½œæˆ
            const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
            // photoDatesé…åˆ—ã«æ—¥ä»˜ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const hasPhoto = photoDates.includes(dateString);
            
            const cell = createDayCell(i, false, isToday, dateString, hasPhoto);
            calendarGrid.appendChild(cell);
        }

        // ç¿Œæœˆã®æ—¥ä»˜ã‚»ãƒ«ã‚’ç”Ÿæˆ (inactive)
        // ã‚°ãƒªãƒƒãƒ‰ã®ã‚»ãƒ«æ•°ãŒ7ã®å€æ•°ã«ãªã‚‹ã¾ã§ã€ã¾ãŸã¯æœ€å¤§6é€±é–“(42ã‚»ãƒ«)ã¾ã§åŸ‹ã‚ã‚‹
        while (calendarGrid.children.length % 7 !== 0) {
             const cell = createDayCell(nextMonthDayCount++, true, false, null, false);
             calendarGrid.appendChild(cell);
        }
        
        updateMonthYearDisplay();
    }

    /**
     * æ—¥ä»˜ã‚»ãƒ«è¦ç´ ã‚’ç”Ÿæˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
     */
    function createDayCell(date, isInactive, isToday, dateString, hasPhoto) {
        const cell = document.createElement('div');
        cell.classList.add('day-cell');
        cell.textContent = date;
        
        if (isInactive) {
            cell.classList.add('inactive');
            cell.style.cursor = 'default'; // å‰æœˆ/ç¿Œæœˆã®æ—¥ä»˜ã¯ã‚¯ãƒªãƒƒã‚¯ä¸å¯ã«
        } else {
            if (isToday) {
                cell.classList.add('today');
            }
            
            // è©³ç´°ãƒšãƒ¼ã‚¸ã¸ã®é·ç§»ã‚’è¨­å®š
            cell.setAttribute('onclick', `location.href='day_detail.html?date=${dateString}'`);
            
            // å†™çœŸãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
            if (hasPhoto) {
                const marker = document.createElement('span');
                marker.classList.add('photo-marker');
                marker.textContent = 'ğŸ“¸';
                cell.appendChild(marker);
            }
        }

        return cell;
    }

    /**
     * å‰ã®æœˆã«ç§»å‹•ã™ã‚‹
     */
    function prevMonth() {
        // ç¾åœ¨ã®æœˆã« -1 ã—ã¦æ–°ã—ã„ Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­å®š
        viewingDate.setMonth(viewingDate.getMonth() - 1);
        renderCalendar();
    }

    /**
     * æ¬¡ã®æœˆã«ç§»å‹•ã™ã‚‹
     */
    function nextMonth() {
        // ç¾åœ¨ã®æœˆã« +1 ã—ã¦æ–°ã—ã„ Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­å®š
        viewingDate.setMonth(viewingDate.getMonth() + 1);
        renderCalendar();
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', () => {
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®åˆæœŸè¡¨ç¤º
        renderCalendar(); 
        
        // æ—¢å­˜ã® showAlbumSection ãªã©ã®ãƒ­ã‚¸ãƒƒã‚¯...
        // ...
    });
    
    // ... (æ—¢å­˜ã® showDeleteModal, deleteMemberConfirmed, showAlbumSection é–¢æ•°ãªã©) ...
    // ğŸ’¡ æ—¢å­˜ã®é–¢æ•°å®šç¾©ã¯çœç•¥ã—ã¦ã„ã¾ã™ãŒã€å¿…è¦ã«å¿œã˜ã¦ãã®ã¾ã¾æ®‹ã—ã¦ãã ã•ã„ã€‚

    // æ—¢å­˜ã® showSection é–¢æ•° (family_member.html ç”¨)
    function showSection(sectionId, element) {
      console.warn('showSection: top.htmlã§ã¯ showAlbumSection ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚');
    }

    function showDeleteModal(memberName, memberId) {
        memberToDeleteId = memberId;
        document.getElementById('modal-message').textContent = `ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`;
        document.getElementById('delete-modal').style.display = 'flex';
    }

    function hideDeleteModal() {
        memberToDeleteId = null;
        document.getElementById('delete-modal').style.display = 'none';
    }

    function deleteMemberConfirmed() {
        if (memberToDeleteId) {
            const memberElement = document.querySelector(`.member-item > .delete-icon[onclick$="'${memberToDeleteId}')"]`).closest('.member-item');
            if (memberElement) {
                memberElement.remove();
            }
            alert(`ID ${memberToDeleteId} ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
        }
        hideDeleteModal(); 
    }
     function showAlbumSection(albumId, element) {
        document.querySelectorAll('.album-tab-item').forEach(tab => tab.classList.remove('active'));
        element.classList.add('active');
        document.querySelectorAll('.album-content-section').forEach(section => section.style.display = 'none');
        const targetSection = document.getElementById(`${albumId}-album-section`);
        if (targetSection) {
            targetSection.style.display = 'block';
        }
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', () => {
     // åˆæœŸè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã¯'all'ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§activeã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€ã“ã“ã§ã¯ç‰¹ã«å‡¦ç†ã¯ä¸è¦
    });
</script>
</body>
</html>
